name: ZenPacks.fednot.Delivery

zProperties:
  zSpringBootPort:
    category: SpringBoot
    type: int
    default: 8105
  zSpringBootApplications:
    category: SpringBoot
    type: lines

class_relationships:
  - SpringBootDevice 1:MC SpringBootApplication
  - SpringBootApplication 1:MC SpringBootComponent
  - SpringBootApplication 1:MC SpringBootJob
  - SpringBootApplication 1:MC SpringBootOrder
  - SpringBootApplication 1:MC SpringBootJVM

classes:
  SpringBootDevice:
    base: [zenpacklib.Device]
    label: SpringBoot Device

  SpringBootApplication:
    base: [zenpacklib.Component]
    label: Application
    monitoring_templates: [SpringBootApplication]
    properties:
      DEFAULTS:
        grid_display: false
      status:
        label: Status
        type: string
        datapoint: health_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      statusString:
        label: Status Label
        type: string
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 350
      healthURL:
        label: Health URL
        grid_display: false
      serviceURL:
        label: Service URL
        grid_display: false

  SpringBootComponent:
    base: [zenpacklib.Component]
    label: Application Component
    monitoring_templates: [SpringBootComponent]
    properties:
      DEFAULTS:
        grid_display: false
      status:
        label: Status
        type: string
        datapoint: health_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      statusString:
        label: Status Label
        type: string
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 350

  SpringBootJob:
    base: [zenpacklib.Component]
    label: Application Job
    monitoring_templates: [SpringBootJob]
    properties:
      DEFAULTS:
        grid_display: false
      jobName:
        label: Job Name
        grid_display: true
      status:
        label: Status
        type: string
        datapoint: job_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      statusString:
        label: Status Label
        type: string
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 350

  SpringBootOrder:
    base: [zenpacklib.Component]
    label: Application Order
    monitoring_templates: [SpringBootOrder]
    properties:
      DEFAULTS:
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 300

  SpringBootJVM:
    base: [zenpacklib.Component]
    label: Application JVM
    monitoring_templates: [SpringBootJVM]
    properties:
      DEFAULTS:
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 300

device_classes:
  /Server/Linux/Applications:
    zProperties:
      zPythonClass: ZenPacks.fednot.Delivery.SpringBootDevice
      zCollectorPlugins:
        - fednot.json.Delivery
      zDeviceTemplates:
        - Device
      # TODO : Add more templates

    templates:
      SpringBootApplication:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootApplication
        datasources:
          health:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.health.Health
            datapoints:
              status:
                rrdtype: GAUGE

      SpringBootComponent:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootComponent
        datasources:
          health:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.health.Health
            datapoints:
              status:
                rrdtype: GAUGE

      SpringBootJob:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootJob
        datasources:
          job:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.jobs.Jobs
            datapoints:
              status:
                rrdtype: GAUGE
              age:
                rrdtype: GAUGE
              dataCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              missingCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
        graphs:
          Messages Counts:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Data Count:
                dpName: job_dataCount
              Missing Count:
                dpName: job_missingCount
          Job Age:
            units: minutes
            width: 1000
            miny: 0
            graphpoints:
              age:
                dpName: job_age

      SpringBootOrder:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootOrder
        datasources:
          order:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.orders.Orders
            datapoints:
              barcode_received:
                rrdtype: GAUGE
              deposit_received:
                rrdtype: GAUGE
              missing_barcode:
                rrdtype: GAUGE
              missing_deposit:
                rrdtype: GAUGE
              missing_validation:
                rrdtype: GAUGE
              new:
                rrdtype: GAUGE
              resent:
                rrdtype: GAUGE
              total:
                rrdtype: GAUGE
              total_check:
                rrdtype: GAUGE
              uploaded:
                rrdtype: GAUGE
              validation_error:
                rrdtype: GAUGE
              validation_received:
                rrdtype: GAUGE
        graphs:
          Received:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Barcode received:
                dpName: order_barcode_received
              Deposit received:
                dpName: order_deposit_received
              Validation received:
                dpName: order_validation_received
          Missing:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Barcode missing:
                dpName: order_missing_barcode
              Deposit missing:
                dpName: order_missing_deposit
              Validation missing:
                dpName: order_missing_validation
          Errors:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Validation error:
                dpName: order_validation_error
          Totals:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Total:
                dpName: order_total
              Total Check:
                dpName: order_total_check
          Messages:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              New:
                dpName: order_new
              Resent:
                dpName: order_resent
              Uploaded:
                dpName: order_uploaded

      SpringBootJVM:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootJVM
        datasources:
          jvm:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.jvm.JVM
            datapoints:
              classes:
                rrdtype: GAUGE
              classes.loaded:
                rrdtype: GAUGE
              classes.unloaded:
                rrdtype: GAUGE
              classes_loaded_total:
                rrdtype: GAUGE
              mem:
                rrdtype: GAUGE
              mem.free:
                rrdtype: GAUGE
              heap.committed:
                rrdtype: GAUGE
              heap.used:
                rrdtype: GAUGE
              heap:
                rrdtype: GAUGE
              systemload.average:
                rrdtype: GAUGE
              threads:
                rrdtype: GAUGE
        graphs:
          Classes:
            units: classes
            width: 1000
            miny: 0
            graphpoints:
              Classes:
                dpName: jvm_classes
              Classes Loaded:
                dpName: jvm_classes.loaded
              Classes Unloaded:
                dpName: jvm_classes.unloaded
          Memory:
            units: bytes
            # TODO : Memory bytes 2014
            width: 1000
            miny: 0
            graphpoints:
              Memory:
                dpName: jvm_mem
              Memory Free:
                dpName: jvm_mem.free
          Heap Memory:
            units: bytes
            width: 1000
            miny: 0
            graphpoints:
              Heap Committed:
                dpName: jvm_heap.committed
              Heap Used:
                dpName: jvm_heap.used
              Heap:
                dpName: jvm_heap
          Load:
            units: percent
            width: 1000
            miny: 0
            graphpoints:
              System Load:
                dpName: jvm_systemload.average
          Threads:
            units: threads
            width: 1000
            miny: 0
            graphpoints:
              Threads:
                dpName: jvm_threads
