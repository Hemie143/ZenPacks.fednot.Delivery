name: ZenPacks.fednot.Delivery

zProperties:
  zSpringBootPort:
    category: SpringBoot
    type: int
    default: 8105
  zSpringBootApplications:
    category: SpringBoot
    type: lines
  zIVGroups:
    category: SpringBoot
    type: string
  zIVUser:
    category: SpringBoot
    type: string

class_relationships:
  - SpringBootDevice 1:MC SpringBootApplication
  - SpringBootApplication 1:MC SpringBootComponent
  - SpringBootApplication 1:MC SpringBootJob
  - SpringBootApplication 1:MC SpringBootZip
  - SpringBootApplication 1:MC SpringBootOrder
  - SpringBootApplication 1:MC SpringBootJVM

classes:
  SpringBootDevice:
    base: [zenpacklib.Device]
    label: SpringBoot Device

  SpringBootApplication:
    base: [zenpacklib.Component]
    label: Application
    monitoring_templates: [SpringBootApplication]
    properties:
      DEFAULTS:
        grid_display: false
      status:
        label: Status
        type: string
        datapoint: health_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      statusString:
        label: Status Label
        type: string
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 350
      mgmtURL:
        label: Management URL
        grid_display: false
      healthURL:
        label: Health URL
        grid_display: false
      serviceURL:
        label: Service URL
        grid_display: false
      hostingServer:
        label: Hosting Server
        grid_display: false

  SpringBootComponent:
    base: [zenpacklib.Component]
    label: Delivery Component
    monitoring_templates: [SpringBootComponent]
    properties:
      DEFAULTS:
        grid_display: false
      status:
        label: Status
        type: string
        datapoint: health_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      statusString:
        label: Status Label
        type: string
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 350

  SpringBootJob:
    base: [zenpacklib.Component]
    label: Delivery Job
    monitoring_templates: [SpringBootJob]
    properties:
      DEFAULTS:
        grid_display: false
      jobName:
        label: Job Name
        grid_display: true
      status:
        label: Status
        type: string
        datapoint: job_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      statusString:
        label: Status Label
        type: string
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 350

  SpringBootZip:
    base: [zenpacklib.Component]
    label: Delivery Zip
    monitoring_templates: [SpringBootZip]
    properties:
      DEFAULTS:
        grid_display: false
      zipName:
        label: Zip Name
      status:
        label: Status
        type: string
        datapoint: job_zip_status
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      dataCount:
        label: Data Count
        type: int
        datapoint: job_dataCount
        grid_display: true
      missingCount:
        label: Missing Count
        type: int
        datapoint: job_missingCount
        grid_display: true

  SpringBootOrder:
    base: [zenpacklib.Component]
    label: Delivery Order
    monitoring_templates: [SpringBootOrder]
    properties:
      DEFAULTS:
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 300

  SpringBootJVM:
    base: [zenpacklib.Component]
    label: Delivery JVM
    monitoring_templates: [SpringBootJVM]
    properties:
      DEFAULTS:
        grid_display: false
      serviceName:
        label: serviceName
        grid_display: true
        label_width: 300

device_classes:
  /Server/Linux/Applications:
    zProperties:
      zPythonClass: ZenPacks.fednot.Delivery.SpringBootDevice
      zCollectorPlugins:
        - fednot.json.SBA
        - fednot.json.Delivery
      zDeviceTemplates:
        - Device
      # TODO : Add more templates

    templates:
      SpringBootApplication:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootApplication
        datasources:
          health:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.health.Health
            datapoints:
              status:
                rrdtype: GAUGE

      SpringBootComponent:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootComponent
        datasources:
          health:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.health.Health
            datapoints:
              status:
                rrdtype: GAUGE

      SpringBootJob:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootJob
        datasources:
          job:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.jobs.Jobs
            datapoints:
              status:
                rrdtype: GAUGE
              age:
                rrdtype: GAUGE
              dataCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              missingCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
        graphs:
          Messages Counts:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Data Count:
                dpName: job_dataCount
                cFunc: LAST
              Missing Count:
                dpName: job_missingCount
                cFunc: LAST
          Job Age:
            units: minutes
            width: 1000
            miny: 0
            graphpoints:
              age:
                dpName: job_age

      SpringBootZip:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootZip
        datasources:
          job:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.jobs.Zips
            datapoints:
              zip_status:
                rrdtype: GAUGE
              dataCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              missingCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'

      SpringBootOrder:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootOrder
        datasources:
          order:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.orders.Orders
            datapoints:
              barcode_received:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              deposit_received:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              missing_barcode:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              missing_deposit:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              missing_validation:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              new:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              resent:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              total:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              total_check:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              uploaded:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              validation_error:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              validation_received:
                rrdtype: DERIVE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
        graphs:
          Received:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Barcode received:
                dpName: order_barcode_received
                cFunc: LAST
              Deposit received:
                dpName: order_deposit_received
                cFunc: LAST
              Validation received:
                dpName: order_validation_received
                cFunc: LAST
              New:
                dpName: order_new
                cFunc: LAST
              Resent:
                dpName: order_resent
                cFunc: LAST
              Uploaded:
                dpName: order_uploaded
                cFunc: LAST
          Missing:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Barcode missing:
                dpName: order_missing_barcode
                cFunc: LAST
              Deposit missing:
                dpName: order_missing_deposit
                cFunc: LAST
              Validation missing:
                dpName: order_missing_validation
                cFunc: LAST
          Errors:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Validation error:
                dpName: order_validation_error
                cFunc: LAST
          Totals:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Total:
                dpName: order_total
                cFunc: LAST
              Total Check:
                dpName: order_total_check
                cFunc: LAST

      SpringBootJVM:
        targetPythonClass: ZenPacks.fednot.Delivery.SpringBootJVM
        datasources:
          jvm:
            type: Python
            plugin_classname: ZenPacks.fednot.Delivery.dsplugins.jvm.JVM
            datapoints:
              classes:
                rrdtype: GAUGE
              classes.loaded:
                rrdtype: GAUGE
              classes.unloaded:
                rrdtype: GAUGE
              classes_loaded_total:
                rrdtype: GAUGE
              mem:
                rrdtype: GAUGE
              mem.free:
                rrdtype: GAUGE
              mem.used:
                rrdtype: GAUGE
              mem.used_percentage:
                rrdtype: GAUGE
              heap.committed:
                rrdtype: GAUGE
              heap.used:
                rrdtype: GAUGE
              heap.used_percentage:
                rrdtype: GAUGE
              heap:
                rrdtype: GAUGE
              systemload.average:
                rrdtype: GAUGE
              threads:
                rrdtype: GAUGE
        graphs:
          Classes:
            units: classes
            width: 1000
            miny: 0
            graphpoints:
              Classes:
                dpName: jvm_classes
              Classes Loaded:
                dpName: jvm_classes.loaded
              Classes Unloaded:
                dpName: jvm_classes.unloaded
          Memory:
            units: bytes
            width: 1000
            miny: 0
            base: True
            # TODO: Colors of graphpoints
            graphpoints:
              Memory:
                dpName: jvm_mem
                lineType: AREA
              Memory Used:
                dpName: jvm_mem.used
                lineType: AREA
          Memory Percentage:
            units: percent
            width: 1000
            miny: 0
            maxy: 100
            # TODO: Colors of graphpoints
            graphpoints:
              Memory Used Percentage:
                dpName: jvm_mem.used_percentage
                lineType: AREA
          Heap Memory:
            units: bytes
            width: 1000
            miny: 0
            base: True
            graphpoints:
              Heap Committed:
                dpName: jvm_heap.committed
                lineType: AREA
              Heap:
                dpName: jvm_heap
              Heap Used:
                dpName: jvm_heap.used
                lineType: AREA
          Heap Memory Percentage:
            units: percent
            width: 1000
            miny: 0
            maxy: 100
            graphpoints:
              Heap Used Percentage:
                dpName: jvm_heap.used_percentage
                lineType: AREA
          Load:
            units: percent
            width: 1000
            miny: 0
            graphpoints:
              System Load:
                dpName: jvm_systemload.average
                lineType: AREA
          Threads:
            units: threads
            width: 1000
            miny: 0
            graphpoints:
              Threads:
                dpName: jvm_threads
